<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<title>Document</title>
	<script type="text/javascript">
	/********************************/
	//P230
	/********************************/
	//定义Animal类
	// function Animal(name){
	// 	//共有属性
	// 	this.name = name || "zhitian";
	// 	this.type = "animal";
	// 	//私有属性
	// 	var age = 20;
	// 	//私有方法
	// 	var move = function(){
	// 		alert("I'm moving now.");
	// 	}
	// };
	// Animal.prototype = {
	// 	//共有方法
	// 	say: function(){
	// 		alert("I'm a " + this.type + ", my name is " + this.name + "I'm" + age);
	// 	},
	// 	act: function(){
	// 		move();
	// 	}
	// };
	// var myDog = new Animal("wangcai");
	// myDog.say();	//age is undefined;
	// myDog.act();	//move() is undefined;
	

	/********************************/
	//P231
	/********************************/
	//定义Animal类
	// function Animal(name){
	// 	//共有属性
	// 	this.name = name || "lenovo";
	// 	this.type = "animal";
	// 	//私有属性
	// 	this._age = 20;
	// };
	// Animal.prototype = {
	// 	//私有方法
	// 	_move : function(){
	// 		alert("I'm moving now!");
	// 	},
	// 	//共有方法
	// 	say : function(){
	// 		alert("I'm a " + this.type + ", my name is " + this.name + ", I'm " + this._age);
	// 	},
	// 	act : function(){
	// 		this._move();
	// 	}
	// };
	// var myDog = new Animal("wangcai");
	// myDog.say();
	// myDog.act();
	// myDog._move();
	// alert(myDog._age);

	
	/********************************/
	//P232
	/********************************/
	// function Animal(name){
	// 	var name; //诡异的变量，变量名与参数名同名，但内部定义的变量如果没有给它赋值，该变量名所对应的值仍是参数传的值;
	// 	var type = "animal";
	// 	var _age = 20;
	// 	this.getName = function(){
	// 		return name;
	// 	};
	// 	this.setName = function(o){
	// 		name = o;
	// 	};
	// 	this.getType = function(){
	// 		return type;
	// 	};
	// 	this.setType = function(o){
	// 		type = o;
	// 	};
	// 	this._getAge = function(){
	// 		return _age;
	// 	};
	// 	this._setAge = function(o){
	// 		_age = o;
	// 	};
	// 	console.log(name);
	// 	this.setName(name);
	// };
	// Animal.prototype = {
	// 	_move : function(){
	// 		alert("I'm moving now!");
	// 	},
	// 	say : function(){
	// 		alert("I'm a " + this.getType() + ",my name is " + this.getName() + ", I'm " + this._getAge());
	// 	},
	// 	act : function(){
	// 		this._move();
	// 	}
	// };

	// //实例化
	// var myDog = new Animal("wangcai");
	// myDog.say();
	// myDog.setType("Dog");
	// alert(myDog.getType());
	// // myDog.setName("lili");
	// alert(myDog.getName());


	/********************************/
	//P233
	/********************************/
	// function Animal(name){
	// 	var name; //诡异的变量，变量名与参数名同名，但内部定义的变量如果没有给它赋值，该变量名所对应的值仍是参数传的值，等同于 var name = name;
	// 	var type = "animal";
	// 	var _age = 20;
	// 	this.getName = function(){
	// 		return name;
	// 	};
	// 	this.setName = function(o){
	// 		if( o != "wangcai" && o != "xiaoqiang"){
	// 			alert("您设置的name值不合要求");
	// 			return;
	// 		};
	// 		name = o;
	// 	};
	// 	this.getType = function(){
	// 		return type;
	// 	};
	// 	this.setType = function(o){
	// 		alert("赋值失败，Animal类的type属性是只读属性");
	// 	};
	// 	this._getAge = function(){
	// 		return _age;
	// 	};
	// 	this._setAge = function(o){
	// 		_age = o;
	// 	};
	// 	console.log(name);
	// 	this.setName(name);
	// };
	// Animal.prototype = {
	// 	_move : function(){
	// 		alert("I'm moving now!");
	// 	},
	// 	say : function(){
	// 		alert("I'm a " + this.getType() + ",my name is " + this.getName() + ", I'm " + this._getAge());
	// 	},
	// 	act : function(){
	// 		this._move();
	// 	}
	// };
	// var myDog = new Animal("wangcai");
	// myDog.say();
	// myDog.setName("abc");
	// alert(myDog.getName());
	// myDog.setName("xiaoqiang");
	// alert(myDog.getName());
	// myDog.setType("dog");



	// var myDog = new Animal("wangcai");
	// var myCat = new Animal("lili");
	// myCat.constructor.prototype.saySomeThing = function(){
	// 	alert( "" + this.getName() + this.getType());
	// };
	// myCat.saySomeThing();
	// myDog.saySomeThing();


	// myCat.prototype.sayThing = function(){
	// 	alert(this.getType());
	// };
	// myCat.sayThing();	//sayThing() is undefined;

	// myCat.constructor.saySome = function(){
	// 	alert(this.getName());
	// };
	// myCat.saySome();		////saySome() is undefined;


	/********************************/
	//P234
	/********************************/
	function Animal(name){
		var name = name;
		var type = "animal";
		var _age = 20;
		//添加master属性, 默认值为adang
		var master = "adang";
		this.getName = function(){
			return name;
		};
		this.setName = function(o){
			if(o != "wangcai" && o != "xiaoqiang"){
				alert("您设置的name值不合要求");
				return;
			};
			name = o;
			//触发name属性的valueChange事件
			this._valueChangeHandler("name");
		};
		//master属性的获取方法
		this.getMaster = function(){
			return master;
		};
		//master属性的设置方法
		this.setMaster = function(o){
			master = o;
			//触发master属性的valueChange事件;
			this._valueChangeHandler("master");
		};
		this.getType = function(){
			return type;
		};
		this.setType = function(o){
			alert("赋值失败，Animal类的type属性是只读属性");
		};
		this._getAge = function(){
			return _age;
		};
		this._setAge = function(){
			_age = o;
		}
	};
	Animal.prototype = {
		_move : function(){
			alert("I'm moving now !");
		},
		say : function(){
			alert("I'm a " + this.getType() + ", my name is " + this.getName() + ", I'm " + this._getAge());
		},
		act : function(){
			this._move();
		},
		//公有行为，用于注册属性的valueChange事件
		onChange : function(valueName, fun){
			this["_"+valueName+"ChangeHandlers"] = this["_"+valueName+"ChangeHandlers"] || [];
			this["_"+valueName+"ChangeHandlers"].push(fun);
		},
		//私有行为，属性valueChange的处理函数
		_valueChangeHandler : function(valueName){
			var o = this["_"+valueName+"ChangeHandlers"];
			if(o){
				for(var i = 0, n = o.length; i < n; i++){
					var methodName = "get"+valueName.charAt(0).toUpperCase()+valueName.slice(1);
					//what is this ?
					// console.log(o[i]);
					o[i](this[methodName]());
				}
			}
		}
	};

	var myDog = new Animal("wangcai");
	//给myDog注册name属性的valueChange事件
	myDog.onChange("name",function(o){
		//回调函数接受新的value值作为参数，可以对其进行匹配
		if(o == "xiaoqiang"){
			alert(1);
		}else{
			alert(2);
		}
	});
	//给myDog换个新名字xiaoqiang;
	myDog.setName("xiaoqiang");
	//给myDog再注册一个name属性的valueChange事件
	myDog.onChange("name",function(o){
		alert("my new name is "+ o);
	});
	//给myDog换个新名字“wangcai”
	myDog.setName("wangcai");
	//给myDog注册master属性的valueChange事件
	myDog.onChange("master",function(o){
		alert("my new master is " + o);
	});
	//给myDog换个master
	myDog.setMaster("licai");

	var myDog2 = new Animal("xiaoqiang");
	//给myDog2注册master属性的valueChange事件
	myDog2.onChange("master",function(o){
		alert(o + "is my new master");
	});
	myDog2.setMaster("zhou yubo");








	/********************************/
	</script>
</head>
<body>
	
</body>
</html>